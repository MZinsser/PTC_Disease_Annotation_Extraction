#GDS allows you to create graphs as part of a catalogue. These graphs can be specified to contain just a certain
#set of relationships. This way you do not have to perform a MATCH to grab relevant relationships each time you want
#to run an algorithm, etc.

#Step 1 is to create a graph with just the annotation relationships, and add to the catalogue.
CALL gds.graph.create('Annotation_Graph', ['Disease', 'Chemical','PMID'], 'is_annotated_in');

#Following code streams similarity results using GDS "Node Similarity" alg which is based on Jaccard
CALL gds.nodeSimilarity.stream('Annotation_Graph')
YIELD node1, node2, similarity
RETURN gds.util.asNode(node1).Name AS Disease1, gds.util.asNode(node2).Name AS Disease2, similarity
ORDER BY similarity DESCENDING, Disease1, Disease2


#TopK for PMID Matches = 100, simCutoff 0.03

CALL gds.nodeSimilarity.write('Annotation_Graph', {similarityCutoff:0.03, topK:100, topN: 0,
    writeRelationshipType: 'SIMILAR',
    writeProperty: 'score'
})
YIELD nodesCompared, relationshipsWritten
